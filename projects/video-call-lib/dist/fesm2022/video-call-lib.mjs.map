{"version":3,"file":"video-call-lib.mjs","sources":["../../src/lib/services/socket.service.ts","../../src/lib/services/webrtc.ts","../../src/lib/services/auth.ts","../../src/lib/services/call-state.ts","../../src/lib/services/signaling.ts","../../src/lib/guards/auth.guard.ts","../../src/lib/video-call-lib.module.ts","../../src/public-api.ts","../../src/video-call-lib.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\r\nimport { Capacitor } from '@capacitor/core';\r\n\r\nlet SIGNALING_URL = 'http://localhost:3000';\r\n\r\nexport const getSignalingUrl = () => SIGNALING_URL;\r\n\r\nexport const setSignalingUrl = (url: string) => {\r\n  SIGNALING_URL = url;\r\n  console.log('‚úì Signaling URL updated to:', SIGNALING_URL);\r\n};\r\n\r\n// Initialize based on platform\r\nconst initializeSignalingUrl = () => {\r\n  const platform = Capacitor.getPlatform();\r\n  if (platform === 'android') {\r\n    SIGNALING_URL = 'http://192.168.1.10:3000'; // Android Emulator - update as needed\r\n  }\r\n};\r\n\r\ninitializeSignalingUrl();\r\n\r\nexport const socket: Socket = io(SIGNALING_URL, {\r\n  transports: ['websocket'],\r\n  reconnection: true,\r\n  reconnectionDelay: 1000,\r\n  reconnectionDelayMax: 5000,\r\n  reconnectionAttempts: 5\r\n});\r\n\r\nsocket.on('connect', () => {\r\n  console.log('‚úì Socket connected to server at', SIGNALING_URL);\r\n  console.log('  Socket ID:', socket.id);\r\n});\r\n\r\nsocket.on('disconnect', () => {\r\n  console.log('‚úó Socket disconnected from server');\r\n});\r\n\r\nsocket.on('connect_error', (error) => {\r\n  console.error('‚ùå Socket connection error:', error);\r\n});\r\n\r\nsocket.on('error', (error) => {\r\n  console.error('‚ùå Socket error:', error);\r\n});\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { socket } from './socket.service';\r\nimport { Capacitor } from '@capacitor/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class WebRTCService {\r\n\r\n  private pc!: RTCPeerConnection;\r\n  private localStream!: MediaStream;\r\n  private remoteStream!: MediaStream;\r\n  private currentRoom: string = '';\r\n  private isInitialized = false;\r\n  private remoteVideoElement: HTMLVideoElement | null = null;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  private baseUrl() {\r\n    const platform = Capacitor.getPlatform();\r\n    console.log('Platform detected:', platform);\r\n    \r\n    // For Android emulator\r\n    if (platform === 'android') {\r\n      return 'http://10.0.2.2:3000';\r\n    }\r\n    // For iOS and web\r\n    return 'http://localhost:3000';\r\n  }\r\n\r\n  async init(room: string, localVideo: HTMLVideoElement, remoteVideo: HTMLVideoElement) {\r\n    try {\r\n      // Prevent re-initialization and remove old listeners\r\n      if (this.isInitialized) {\r\n        console.log('Already initialized, cleaning up...');\r\n        this.cleanup();\r\n      }\r\n\r\n      this.currentRoom = room;\r\n      this.remoteVideoElement = remoteVideo;\r\n      this.remoteStream = new MediaStream();\r\n      console.log('Initializing WebRTC for room:', room);\r\n\r\n      let iceServers: RTCIceServer[] = [];\r\n      \r\n      try {\r\n        const iceServersResponse = await this.http\r\n          .get<RTCIceServer[]>(`${this.baseUrl()}/ice`)\r\n          .toPromise();\r\n        \r\n        if (Array.isArray(iceServersResponse)) {\r\n          iceServers = iceServersResponse;\r\n        }\r\n      } catch (err) {\r\n        console.warn('Failed to fetch ICE servers, using empty array:', err);\r\n      }\r\n\r\n      const peerConfig: RTCConfiguration = { iceServers };\r\n      this.pc = new RTCPeerConnection(peerConfig);\r\n\r\n      this.localStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: 'user' },\r\n        audio: true\r\n      }).catch(err => {\r\n        console.error('Error getting media devices:', err.message);\r\n        throw new Error('Failed to access camera/microphone: ' + err.message);\r\n      });\r\n\r\n      console.log('Local stream obtained:', this.localStream.getTracks().map(t => t.kind));\r\n      localVideo.srcObject = this.localStream;\r\n\r\n      this.localStream.getTracks().forEach(t =>\r\n        this.pc.addTrack(t, this.localStream)\r\n      );\r\n\r\n      this.pc.ontrack = e => {\r\n        console.log('Remote track received:', e.track.kind, 'Track enabled:', e.track.enabled, 'Stream count:', e.streams.length);\r\n        \r\n        // Add the track to the remote stream instead of replacing the entire stream\r\n        // This ensures we keep both audio and video tracks\r\n        const trackExists = this.remoteStream.getTracks().find(t => t.id === e.track.id);\r\n        if (!trackExists) {\r\n          this.remoteStream.addTrack(e.track);\r\n          console.log('Added', e.track.kind, 'track to remote stream. Current tracks:', this.remoteStream.getTracks().map(t => t.kind));\r\n        } else {\r\n          console.log('Track', e.track.id, 'already exists in remote stream');\r\n        }\r\n        \r\n        if (this.remoteVideoElement) {\r\n          // Ensure the video element has the stream\r\n          if (this.remoteVideoElement.srcObject !== this.remoteStream) {\r\n            this.remoteVideoElement.srcObject = this.remoteStream;\r\n            console.log('‚úì Remote video srcObject updated');\r\n          }\r\n          console.log('Remote stream tracks:', this.remoteStream.getTracks().map(t => ({ kind: t.kind, enabled: t.enabled, id: t.id })));\r\n        } else {\r\n          console.warn('‚ö†Ô∏è Remote video element not available');\r\n        }\r\n      };\r\n\r\n      this.pc.onconnectionstatechange = () => {\r\n        console.log('Peer connection state:', this.pc.connectionState);\r\n        if (this.pc.connectionState === 'failed') {\r\n          console.error('Peer connection failed');\r\n        }\r\n        if (this.pc.connectionState === 'connected') {\r\n          console.log('Peer connection established');\r\n        }\r\n      };\r\n\r\n      this.pc.oniceconnectionstatechange = () => {\r\n        console.log('ICE connection state:', this.pc.iceConnectionState);\r\n      };\r\n\r\n      this.pc.onicegatheringstatechange = () => {\r\n        console.log('ICE gathering state:', this.pc.iceGatheringState);\r\n      };\r\n\r\n      this.pc.onicecandidate = e => {\r\n        if (e.candidate) {\r\n          console.log('Sending ICE candidate');\r\n          socket.emit('ice', { room, candidate: e.candidate });\r\n        }\r\n      };\r\n\r\n      // Register socket listeners only once\r\n      this.setupSocketListeners(room);\r\n\r\n      console.log('Joining room:', room);\r\n      console.log('üìç Make sure you have 2 peers in the same room for video to work!');\r\n      socket.emit('join', { room });\r\n      \r\n      this.isInitialized = true;\r\n    } catch (err) {\r\n      console.error('Error initializing WebRTC:', err);\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  private setupSocketListeners(room: string) {\r\n    // Remove old listeners first\r\n    socket.off('peer-joined');\r\n    socket.off('offer');\r\n    socket.off('answer');\r\n    socket.off('ice');\r\n\r\n    socket.on('peer-joined', async () => {\r\n      console.log('üîî [SIGNALING] Peer joined the room, creating offer...');\r\n      try {\r\n        const offer = await this.pc.createOffer();\r\n        console.log('üì§ [SIGNALING] Offer created:', offer.type);\r\n        await this.pc.setLocalDescription(offer);\r\n        console.log('‚úì [SIGNALING] Local description set, sending offer');\r\n        socket.emit('offer', { room, offer });\r\n      } catch (err) {\r\n        console.error('‚ùå [SIGNALING] Error creating offer:', err);\r\n      }\r\n    });\r\n\r\n    socket.on('offer', async (data: any) => {\r\n      console.log('üì• [SIGNALING] Received offer from remote peer');\r\n      try {\r\n        const offer = data.offer || data;\r\n        console.log('üì• [SIGNALING] Setting remote description for offer');\r\n        await this.pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n        console.log('‚úì [SIGNALING] Remote description set, creating answer...');\r\n        const answer = await this.pc.createAnswer();\r\n        console.log('üì§ [SIGNALING] Answer created:', answer.type);\r\n        await this.pc.setLocalDescription(answer);\r\n        console.log('‚úì [SIGNALING] Local description set, sending answer');\r\n        socket.emit('answer', { room, answer });\r\n      } catch (err) {\r\n        console.error('‚ùå [SIGNALING] Error handling offer:', err);\r\n      }\r\n    });\r\n\r\n    socket.on('answer', async (data: any) => {\r\n      console.log('üì• [SIGNALING] Received answer from remote peer');\r\n      try {\r\n        const answer = data.answer || data;\r\n        console.log('üì• [SIGNALING] Setting remote description from answer:', answer.type);\r\n        await this.pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n        console.log('‚úì [SIGNALING] Remote description set - Connection should be established');\r\n      } catch (err) {\r\n        console.error('‚ùå [SIGNALING] Error handling answer:', err);\r\n      }\r\n    });\r\n\r\n    socket.on('ice', async (data: any) => {\r\n      try {\r\n        const candidate = data.candidate || data;\r\n        if (candidate) {\r\n          console.log('üßä [ICE] Adding ICE candidate');\r\n          await this.pc.addIceCandidate(new RTCIceCandidate(candidate));\r\n        }\r\n      } catch (err) {\r\n        console.error('‚ùå [ICE] Error adding ice candidate:', err);\r\n      }\r\n    });\r\n  }\r\n\r\n  private cleanup() {\r\n    socket.off('peer-joined');\r\n    socket.off('offer');\r\n    socket.off('answer');\r\n    socket.off('ice');\r\n  }\r\n\r\n  async switchCamera() {\r\n    if (!this.localStream) {\r\n      console.warn('Local stream not available');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const videoTracks = this.localStream.getVideoTracks();\r\n      if (videoTracks.length === 0) {\r\n        console.warn('No video tracks available');\r\n        return;\r\n      }\r\n\r\n      const videoTrack = videoTracks[0];\r\n      const settings = videoTrack.getSettings();\r\n      const newFacing = settings.facingMode === 'user' ? 'environment' : 'user';\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: newFacing },\r\n        audio: true\r\n      });\r\n\r\n      const newTrack = stream.getVideoTracks()[0];\r\n      const sender = this.pc.getSenders().find(s => s.track?.kind === 'video');\r\n      \r\n      if (sender) {\r\n        await sender.replaceTrack(newTrack);\r\n      }\r\n\r\n      videoTrack.stop();\r\n      this.localStream.removeTrack(videoTrack);\r\n      this.localStream.addTrack(newTrack);\r\n    } catch (err) {\r\n      console.error('Error switching camera:', err);\r\n    }\r\n  }\r\n\r\n  leave() {\r\n    console.log('Leaving call...');\r\n    this.cleanup();\r\n    this.isInitialized = false;\r\n    this.localStream?.getTracks().forEach(t => t.stop());\r\n    this.pc?.close();\r\n    socket.emit('leave', { room: this.currentRoom });\r\n  }\r\n\r\n  pause() {\r\n    this.localStream?.getTracks().forEach(t => t.enabled = false);\r\n  }\r\n\r\n  resume() {\r\n    this.localStream?.getTracks().forEach(t => t.enabled = true);\r\n  }\r\n\r\n  toggleAudio(enabled: boolean) {\r\n    this.localStream?.getAudioTracks().forEach(t => t.enabled = enabled);\r\n  }\r\n\r\n  toggleVideo(enabled: boolean) {\r\n    this.localStream?.getVideoTracks().forEach(t => t.enabled = enabled);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthService {\r\n  login() {\r\n    localStorage.setItem('token', 'dummy-token');\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem('token');\r\n  }\r\n\r\n  isLoggedIn(): boolean {\r\n    return !!localStorage.getItem('token');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class CallStateService {\r\n  private roomId$ = new BehaviorSubject<string | null>(null);\r\n\r\n  setRoom(id: string) {\r\n    this.roomId$.next(id);\r\n  }\r\n\r\n  getRoom() {\r\n    return this.roomId$.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class Signaling {\r\n  \r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { CanActivate, Router } from '@angular/router';\r\nimport { AuthService } from '../services/auth';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AuthGuard implements CanActivate {\r\n\r\n  constructor(private auth: AuthService, private router: Router) {}\r\n\r\n  canActivate(): boolean {\r\n    if (this.auth.isLoggedIn()) return true;\r\n    this.router.navigate(['/']);\r\n    return false;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { WebRTCService } from './services/webrtc';\r\nimport { CallStateService } from './services/call-state';\r\nimport { AuthService } from './services/auth';\r\nimport { Signaling } from './services/signaling';\r\nimport { AuthGuard } from './guards/auth.guard';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    HttpClientModule,\r\n    IonicModule\r\n  ],\r\n  providers: [\r\n    WebRTCService,\r\n    CallStateService,\r\n    AuthService,\r\n    Signaling,\r\n    AuthGuard\r\n  ]\r\n})\r\nexport class VideoCallLibModule {}\r\n","/*\r\n * Public API Surface of video-call-lib\r\n */\r\n\r\n// Services\r\nexport * from './lib/services/webrtc';\r\nexport * from './lib/services/socket.service';\r\nexport * from './lib/services/auth';\r\nexport * from './lib/services/call-state';\r\nexport * from './lib/services/signaling';\r\n\r\n// Guards\r\nexport * from './lib/guards/auth.guard';\r\n\r\n// Module\r\nexport * from './lib/video-call-lib.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1.AuthService"],"mappings":"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"}